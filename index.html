<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê±´ë¬¼ ë„ê°</title>
    <style>
        body { font-family: sans-serif; text-align: center; margin: 0; padding: 20px; background: #f4f4f4; }
        h1 { margin-bottom: 10px; }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-start {
            padding: 15px 30px; font-size: 20px; background: #007bff; color: white;
            border: none; border-radius: 10px; cursor: pointer; margin-bottom: 20px;
        }
        
        /* ì¹´ë©”ë¼ í™”ë©´ */
        #webcam-container {
            border-radius: 10px; overflow: hidden; display: inline-block;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        canvas { width: 100%; max-width: 350px; height: auto; }

        /* ê²°ê³¼ì°½ */
        #label-container {
            margin-top: 20px; background: white; padding: 20px; border-radius: 10px;
            display: none; /* ì²˜ìŒì—” ì•ˆ ë³´ì„ */
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            cursor: pointer; /* í´ë¦­ ê°€ëŠ¥ í‘œì‹œ */
        }
        .title { font-size: 24px; font-weight: bold; color: #333; }
        .desc { font-size: 16px; color: #666; margin: 10px 0; }
        .link-msg { font-size: 14px; color: #007bff; font-weight: bold; text-decoration: underline; }
    </style>
</head>
<body>

    <h1>ğŸ™ï¸ ê±´ë¬¼ ì •ë³´ íŒë…ê¸°</h1>
    
    <button class="btn-start" onclick="init()">ğŸ“¸ ì¹´ë©”ë¼ ì¼œê¸°</button>
    
    <div id="webcam-container"></div>
    
    <div id="label-container" onclick="goToLink()">
        <div id="result-title" class="title"></div>
        <div id="result-desc" class="desc"></div>
        <div id="result-link" class="link-msg"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    
    <script type="text/javascript">
        // â˜…â˜…â˜… [1] ì—¬ê¸°ì— ë³¸ì¸ì˜ í‹°ì²˜ë¸” ë¨¸ì‹  ì£¼ì†Œë¥¼ ë„£ìœ¼ì„¸ìš” â˜…â˜…â˜…
        const URL = "https://teachablemachine.withgoogle.com/models/FZXHT2jEt/";

        let model, webcam, maxPredictions;
        let currentLink = ""; // í˜„ì¬ ì¸ì‹ëœ ê±´ë¬¼ì˜ ë§í¬ ì €ì¥

        // â˜…â˜…â˜… [2] ê±´ë¬¼ ì„¤ëª… ì„¤ì • â˜…â˜…â˜…
        const buildingInfo = {
            "Class 1": "ì´ ê±´ë¬¼ì€ 1ë²ˆ ê±´ë¬¼ì…ë‹ˆë‹¤.",
            "Class 2": "ì´ ê±´ë¬¼ì€ 2ë²ˆ ê±´ë¬¼ì…ë‹ˆë‹¤."
        };

        // â˜…â˜…â˜… [3] ê±´ë¬¼ ë§í¬ ì„¤ì • (ìš”ì²­í•˜ì‹  ë§í¬ ì ìš©ë¨) â˜…â˜…â˜…
        const buildingLinks = {
            "Class 1": "https://rkddmltlf.github.io/4",
            "Class 2": "https://www.google.com"
        };

        async function init() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            try {
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();

                const flip = false; // í›„ë©´ ì¹´ë©”ë¼ëŠ” ë°˜ì „ ì—†ìŒ
                webcam = new tmImage.Webcam(300, 300, flip);
                
                // ëª¨ë°”ì¼ í›„ë©´ ì¹´ë©”ë¼ ìš”ì²­
                await webcam.setup({ facingMode: "environment" });
                await webcam.play();
                
                window.requestAnimationFrame(loop);

                document.getElementById("webcam-container").appendChild(webcam.canvas);
                document.querySelector(".btn-start").style.display = "none"; // ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            } catch (e) {
                alert("ì¹´ë©”ë¼ë¥¼ ì¼¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. https ì£¼ì†Œì¸ì§€ í™•ì¸í•˜ì„¸ìš”! ì˜¤ë¥˜ë‚´ìš©: " + e);
            }
        }

        async function loop() {
            webcam.update();
            await predict();
            window.requestAnimationFrame(loop);
        }

        async function predict() {
            const prediction = await model.predict(webcam.canvas);
            
            let highestProb = 0;
            let bestClassName = "";

            // ê°€ì¥ ë†’ì€ í™•ë¥  ì°¾ê¸°
            for (let i = 0; i < maxPredictions; i++) {
                if (prediction[i].probability > highestProb) {
                    highestProb = prediction[i].probability;
                    bestClassName = prediction[i].className;
                }
            }

            const container = document.getElementById("label-container");
            const titleDiv = document.getElementById("result-title");
            const descDiv = document.getElementById("result-desc");
            const linkDiv = document.getElementById("result-link");

            // í™•ë¥ ì´ 85% ë„˜ì„ ë•Œë§Œ í‘œì‹œ
            if (highestProb > 0.85) {
                container.style.display = "block";
                titleDiv.innerText = bestClassName;

                // ì„¤ëª… í‘œì‹œ
                if (buildingInfo[bestClassName]) {
                    descDiv.innerText = buildingInfo[bestClassName];
                } else {
                    descDiv.innerText = "ì„¤ëª…ì´ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
                }

                // ë§í¬ ì„¤ì •
                if (buildingLinks[bestClassName]) {
                    currentLink = buildingLinks[bestClassName];
                    linkDiv.innerText = "ğŸ‘‰ í„°ì¹˜í•˜ì—¬ ìƒì„¸í˜ì´ì§€ë¡œ ì´ë™";
                    linkDiv.style.display = "block";
                } else {
                    currentLink = "";
                    linkDiv.style.display = "none";
                }
            }
        }

        // ë°•ìŠ¤ í´ë¦­ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
        function goToLink() {
            if (currentLink) {
                window.location.href = currentLink;
            }
        }
    </script>
</body>
</html>
